<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Kalkulator Oranye — Rasi Bintang</title>
    <style>
      :root {
        --bg: #0b0710;
        --orange-1: #ff7a18;
        --orange-2: #ffb66b;
        --panel: rgba(255, 255, 255, 0.04);
        --glass: rgba(255, 255, 255, 0.04);
        --accent: #ffd6a6;
        --glass-border: rgba(255, 200, 120, 0.06);
        --shadow: 0 8px 30px rgba(255, 106, 20, 0.06);
        --glass-2: rgba(255, 255, 255, 0.02);
        font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI",
          Roboto, "Helvetica Neue", Arial;
      }

      #stars {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: -1;
        display: block;
      }

      html,
      body {
        height: 100%;
        margin: 0;
        background: transparent;
        color: #fff;
      }

      .wrap {
        min-height: 100vh;
        display: grid;
        place-items: center;
        padding: 48px 20px;
      }

      /* Card */
      .card {
        width: 100%;
        max-width: 460px;
        border-radius: 18px;
        padding: 28px;
        background: linear-gradient(
          180deg,
          rgba(255, 140, 60, 0.06),
          rgba(255, 140, 60, 0.02)
        );
        box-shadow: var(--shadow);
        backdrop-filter: blur(8px) saturate(120%);
        border: 1px solid var(--glass-border);
        position: relative;
        overflow: hidden;
        transform-origin: center;
        transition: transform 0.35s cubic-bezier(0.2, 0.9, 0.3, 1);
      }

      .card:hover {
        transform: translateY(-8px) scale(1.01);
      }

      /* header */
      .head {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 14px;
      }

      .logo {
        width: 56px;
        height: 56px;
        border-radius: 12px;
        background: linear-gradient(135deg, var(--orange-1), var(--orange-2));
        display: grid;
        place-items: center;
        box-shadow: 0 6px 18px rgba(255, 122, 24, 0.18);
        font-weight: 700;
        color: #2b0200;
      }

      .title {
        line-height: 1;
      }

      .title h1 {
        margin: 0;
        font-size: 18px;
      }

      .title p {
        margin: 0;
        font-size: 12px;
        opacity: 0.85;
      }

      .display {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.03),
          rgba(255, 255, 255, 0.01)
        );
        border-radius: 12px;
        padding: 18px;
        display: flex;
        flex-direction: column;
        gap: 6px;
        margin-bottom: 16px;
        border: 1px solid rgba(255, 255, 255, 0.02);
      }

      .expression {
        font-size: 14px;
        opacity: 0.7;
        min-height: 18px;
        word-break: break-all;
        text-align: right;
      }

      .result {
        font-size: 28px;
        font-weight: 700;
        letter-spacing: 0.6px;
        min-height: 34px;
        display: flex;
        align-items: center;
        justify-content: flex-end;
      }

      .pad {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
      }

      .btn {
        border-radius: 10px;
        padding: 14px 10px;
        text-align: center;
        font-weight: 600;
        cursor: pointer;
        user-select: none;
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.02);
        background: var(--panel);
        transition: transform 0.25s cubic-bezier(0.2, 0.9, 0.3, 1),
          box-shadow 0.25s, filter 0.25s;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.45);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        color: var(--accent);
      }

      .btn.op {
        color: var(--orange-1);
        font-weight: 700;
        background: linear-gradient(
          180deg,
          rgba(255, 122, 24, 0.06),
          rgba(255, 122, 24, 0.02)
        );
      }

      .btn.eq {
        grid-column: span 2;
        background: linear-gradient(90deg, var(--orange-1), var(--orange-2));
        color: #2b0200;
        box-shadow: 0 12px 30px rgba(255, 122, 24, 0.18);
      }

      .btn.clear {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(255, 255, 255, 0.01)
        );
        color: #fff;
        opacity: 0.9;
      }

      .btn::after {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 10px;
        pointer-events: none;
        transition: transform 0.5s cubic-bezier(0.2, 0.9, 0.3, 1), opacity 0.35s;
        transform: scale(0);
        opacity: 0;
        background: radial-gradient(
          circle at center,
          rgba(255, 255, 255, 0.08),
          transparent 30%
        );
      }

      .btn:hover {
        transform: translateY(-6px) rotateX(7deg);
        filter: brightness(1.04);
      }

      .btn:hover::after {
        transform: scale(1);
        opacity: 1;
      }

      .btn.op:hover {
        box-shadow: 0 8px 40px rgba(255, 122, 24, 0.25),
          0 0 28px rgba(255, 180, 100, 0.06) inset;
      }

      .btn.eq:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 18px 50px rgba(255, 122, 24, 0.28);
      }

      .ripple {
        position: absolute;
        border-radius: 50%;
        transform: scale(0);
        animation: ripple 0.6s linear;
        opacity: 0.9;
        background: rgba(255, 255, 255, 0.12);
      }

      @keyframes ripple {
        to {
          transform: scale(6);
          opacity: 0;
        }
      }

      .helpers {
        display: flex;
        gap: 8px;
        margin-bottom: 8px;
      }

      .chip {
        background: var(--glass-2);
        padding: 6px 10px;
        border-radius: 999px;
        font-size: 13px;
        border: 1px solid rgba(255, 255, 255, 0.02);
        opacity: 0.85;
      }

      @media (max-width: 420px) {
        .card {
          padding: 18px;
          border-radius: 14px;
        }

        .logo {
          width: 48px;
          height: 48px;
        }

        .btn {
          padding: 12px;
          font-size: 16px;
        }

        .result {
          font-size: 24px;
        }
      }

      .constellation-overlay {
        position: absolute;
        inset: 0;
        pointer-events: none;
      }

      .foot {
        margin-top: 12px;
        font-size: 12px;
        opacity: 0.6;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo .star {
        filter: drop-shadow(0 6px 12px rgba(255, 140, 60, 0.18));
        animation: twinkle 3.4s infinite;
      }

      @keyframes twinkle {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }

        50% {
          opacity: 0.6;
          transform: scale(0.86);
        }
      }
    </style>
  </head>

  <body>
    <canvas id="stars"></canvas>
    <div class="wrap">
      <div
        class="card"
        role="application"
        aria-label="Kalkulator Oranye dengan rasi bintang"
      >
        <div class="head">
          <div class="logo" aria-hidden="true">
            <svg
              width="30"
              height="30"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M12 2L14 8L20 9L15 13L16 19L12 16L8 19L9 13L4 9L10 8L12 2Z"
                fill="#fff"
                opacity="0.96"
              />
            </svg>
          </div>
          <div class="title">
            <h1>ORANGE CALCULATOR</h1>
            <p>Design By Haerul</p>
          </div>
        </div>

        <div class="display" id="display">
          <div class="expression" id="expression" aria-live="polite"></div>
          <div class="result" id="result">0</div>
        </div>

        <div class="helpers">
          <div class="chip">Klik/Ketik — 0-9 + - × ÷ . ( )</div>
          <div class="chip">Keyboard: Enter = =, Backspace = ⌫</div>
        </div>

        <div class="pad" id="pad">
          <div class="btn clear" data-key="C">C</div>
          <div class="btn" data-key="(">(</div>
          <div class="btn" data-key=")">)</div>
          <div class="btn op" data-key="/">÷</div>
          <div class="btn" data-key="7">7</div>
          <div class="btn" data-key="8">8</div>
          <div class="btn" data-key="9">9</div>
          <div class="btn op" data-key="*">×</div>
          <div class="btn" data-key="4">4</div>
          <div class="btn" data-key="5">5</div>
          <div class="btn" data-key="6">6</div>
          <div class="btn op" data-key="-">−</div>
          <div class="btn" data-key="1">1</div>
          <div class="btn" data-key="2">2</div>
          <div class="btn" data-key="3">3</div>
          <div class="btn op" data-key="+">+</div>
          <div class="btn" data-key="0">0</div>
          <div class="btn" data-key=".">.</div>
          <div class="btn" data-key="%">%</div>
          <div class="btn" data-key="DEL">⌫</div>
          <div class="btn eq" data-key="=">=</div>
        </div>

        <div class="foot">
          <div>Made with — Haerul</div>
          <div style="opacity: 0.8">v1.5</div>
        </div>

        <svg
          class="constellation-overlay"
          viewBox="0 0 100 100"
          preserveAspectRatio="none"
          aria-hidden="true"
        ></svg>
      </div>
    </div>

    <script>
      /* STARFIELD + CONSTELLATIONS */
      (function () {
        const canvas = document.getElementById("stars");
        const ctx = canvas.getContext("2d");
        let w = (canvas.width = innerWidth);
        let h = (canvas.height = innerHeight);
        window.addEventListener("resize", () => {
          w = canvas.width = innerWidth;
          h = canvas.height = innerHeight;
          initStars();
        });

        const stars = [];

        function rand(min, max) {
          return Math.random() * (max - min) + min;
        }

        function initStars() {
          stars.length = 0;
          const N = Math.max(120, Math.floor((w * h) / 20000));
          for (let i = 0; i < N; i++) {
            stars.push({
              x: rand(0, w),
              y: rand(0, h),
              r: rand(0.6, 1.8),
              alpha: rand(0.2, 1),
              vx: rand(-0.02, 0.02),
            });
          }
          const idx = [];
          for (let i = 0; i < 6; i++)
            idx.push(Math.floor(rand(0, stars.length)));
          constellation.nodes = idx.map((i) => stars[i]);
        }

        const constellation = {
          nodes: [],
          t: 0,
        };

        function draw() {
          ctx.clearRect(0, 0, w, h);
          const g = ctx.createLinearGradient(0, 0, 0, h);
          g.addColorStop(0, "rgba(10,6,16,1)");
          g.addColorStop(1, "rgba(3,2,6,1)");
          ctx.fillStyle = g;
          ctx.fillRect(0, 0, w, h);

          for (const s of stars) {
            s.x += s.vx;
            if (s.x < -10) s.x = w + 10;
            if (s.x > w + 10) s.x = -10;
            ctx.beginPath();
            ctx.globalAlpha =
              0.9 *
              s.alpha *
              Math.abs(Math.sin(performance.now() / 1000 + s.x * 0.0005));
            ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
            ctx.fillStyle = "rgba(255,205,160,1)";
            ctx.fill();
          }
          ctx.globalAlpha = 1;

          constellation.t += 0.005;
          const n = constellation.nodes;
          if (n.length > 1) {
            ctx.lineWidth = 1.1;
            ctx.strokeStyle = "rgba(255,165,70,0.12)";
            ctx.beginPath();
            for (let i = 0; i < n.length; i++) {
              const a = n[i];
              const b = n[(i + 1) % n.length];
              const ax = a.x + Math.sin(constellation.t + i) * 6;
              const ay = a.y + Math.cos(constellation.t + i) * 6;
              const bx = b.x + Math.cos(constellation.t + i * 1.3) * 6;
              const by = b.y + Math.sin(constellation.t + i * 1.2) * 6;
              ctx.moveTo(ax, ay);
              ctx.lineTo(bx, by);
            }
            ctx.stroke();

            for (let i = 0; i < n.length; i++) {
              const p = n[i];
              const r = 2.6 + 1.6 * Math.sin(constellation.t * 3 + i);
              ctx.beginPath();
              ctx.fillStyle = "rgba(255,200,120,0.95)";
              ctx.arc(p.x, p.y, r, 0, Math.PI * 2);
              ctx.fill();
            }
          }
          requestAnimationFrame(draw);
        }
        initStars();
        draw();
      })();

      /* CALCULATOR LOGIC */
      (function () {
        const expressionEl = document.getElementById("expression");
        const resultEl = document.getElementById("result");
        const pad = document.getElementById("pad");
        let expr = "";

        function update() {
          expressionEl.textContent = expr || "";
          try {
            const safe = sanitize(expr);
            const val = safe ? evaluate(safe) : "";
            resultEl.textContent =
              val !== "" && val !== undefined ? formatResult(val) : "0";
          } catch (e) {
            resultEl.textContent = "Error";
          }
        }

        function sanitize(s) {
          if (!s) return "";
          if (/[^0-9()+\-*/.%\s]/.test(s)) return "";
          return s.replace(/×/g, "*").replace(/÷/g, "/").replace(/−/g, "-");
        }

        function evaluate(s) {
          const replaced = s.replace(/(\d+(?:\.\d+)?)%/g, "($1/100)");
          if (/\*\*|\/\//.test(replaced)) throw "bad";
          return Function("return (" + replaced + ")")();
        }

        function formatResult(v) {
          if (typeof v === "number" && !isFinite(v)) return "∞";
          if (typeof v === "number") {
            const str = v.toString();
            if (str.length > 12) return v.toPrecision(10);
            return Number(v.toFixed(10)).toString();
          }
          return v;
        }

        // ✅ LOGIKA FUNGSI PRESS DIPERBAIKI UNTUK MENERIMA 'event'
        function press(key, el, event) {
          if (el) createRipple(el, event); // Teruskan 'event' ke createRipple

          if (key === "C") {
            expr = "";
            update();
            return;
          }
          if (key === "=") {
            compute();
            return;
          }
          if (key === "DEL") {
            expr = expr.slice(0, -1);
            update();
            return;
          }
          if (key === "%") {
            expr += "%";
            update();
            return;
          }
          expr += key;
          update();
        }

        function compute() {
          try {
            const s = sanitize(expr);
            if (!s) return;
            const val = evaluate(s);
            expr = String(val);
            update();
          } catch (e) {
            resultEl.textContent = "Error";
          }
        }

        // ✅ LOGIKA FUNGSI CREATE RIPPLE DIPERBAIKI (TIDAK LAGI PAKAI window.event)
        function createRipple(el, event) {
          const circle = document.createElement("span");
          circle.className = "ripple";
          const d = Math.max(el.clientWidth, el.clientHeight);
          circle.style.width = circle.style.height = d + "px";

          // Gunakan objek 'event' yang diterima dari parameter, bukan 'window.event'
          if (event) {
            const rect = el.getBoundingClientRect();
            circle.style.left = event.clientX - rect.left - d / 2 + "px";
            circle.style.top = event.clientY - rect.top - d / 2 + "px";
          }

          el.appendChild(circle);
          circle.addEventListener("animationend", () => circle.remove());
        }

        // ✅ EVENT LISTENER DIPERBAIKI UNTUK MENGIRIM 'e'
        pad.addEventListener("click", (e) => {
          const btn = e.target.closest(".btn");
          if (!btn) return;
          const key = btn.dataset.key;
          press(key, btn, e); // Kirim event 'e' ke fungsi press
        });

        window.addEventListener("keydown", (e) => {
          const keyMap = {
            Enter: "=",
            Backspace: "DEL",
            "*": "*",
            "/": "/",
            "+": "+",
            "-": "-",
            "(": "(",
            ")": ")",
            "%": "%",
            ".": ".",
          };
          const mappedKey = keyMap[e.key];

          if (/[0-9]/.test(e.key)) {
            press(e.key, null, e);
          } else if (mappedKey) {
            press(mappedKey, null, e);
            e.preventDefault();
          }
        });

        update();

        const clearBtn = document.querySelector(".btn.clear");
        let holdTimer;
        clearBtn.addEventListener("pointerdown", () => {
          holdTimer = setTimeout(() => {
            expr = "";
            update();
          }, 600);
        });
        window.addEventListener("pointerup", () => {
          clearTimeout(holdTimer);
        });
      })();
    </script>
  </body>
</html>
